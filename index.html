<!DOCTYPE html>
<html>

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <title>Максимум Апокалипсис - помощник</title>
    <link rel="icon" type="image/x-icon" href="logo-square.png">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-GLhlTQ8iRABdZLl6O3oVMWSktQOp6b7In1Zl3/Jr59b6EGGoI1aFkw7cmDA6j6gD" crossorigin="anonymous">
</head>

<body>
    <div class="container">
        <h2>Максимум Апокалипсис</h2>
        <h3>Находки</h3>
        <div class="mb-3 row fixed-top" id="status-alert"></div>
        <div class="mb-3 row">
            <div class="col-sm-10">
                <div class="d-grid gap-2 d-md-block">
                    <button type="button" class="btn btn-outline-danger" onclick="drawCardClick('red')">Взять карту <small class="deck-size">(0)</small></button>
                    <button type="button" class="btn btn-outline-success" onclick="drawCardClick('green')">Взять карту <small class="deck-size">(0)</small></button>
                    <button type="button" class="btn btn-outline-primary" onclick="drawCardClick('blue')">Взять карту <small class="deck-size">(0)</small></button>
                </div>
            </div>
        </div>

        <hr>
        <form>
            <label for="add-card-select" class="col-sm-2 col-form-label">Вернуть карту</label>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="put-direct" id="direct-up" value="up">
                <label class="form-check-label" for="direct-up">наверх колоды</label>
            </div>
            <div class="form-check form-check-inline">
                <input class="form-check-input" type="radio" name="put-direct" id="direct-down" value="down" checked>
                <label class="form-check-label" for="direct-down">под низ колоды</label>
            </div>              
            <div class="mb-3 row">
                <label for="add-card-select" class="col-sm-2 col-form-label">Находки:</label>
                <div class="col-sm-10">
                    <select id="add-card-select" class="form-select">
                        <option value="medicaments">Медикаменты</option>
                        <option value="junk">Хлам</option>
                        <option value="binoculars">Бинокль</option>
                        <option value="fuel">Топливо</option>
                        <option value="pistol">Пистолет</option>
                        <option value="flashlight">Фонарь</option>
                        <option value="antidote">Противоядие</option>
                        <option value="ambush">Засада</option>
                        <option value="spares">Запчасти</option>
                        <option value="rucksack">Рюкзак</option>
                        <option value="radio-set">Рация</option>
                        <option value="" disabled>--</option>
                        <option value="products-1">Продукты (1)</option>
                        <option value="products-1-all">Продуктовая корзина (1)</option>
                        <option value="products-2">Продукты (2)</option>
                        <option value="products-3">Продукты (3)</option>
                        <option value="products-4">Продукты (4)</option>
                        <option value="products-5">Продукты (5)</option>
                        <option value="" disabled>--</option>
                        <option value="armament">Вооружение</option>
                        <option value="armament-2">Вооружение (2)</option>
                        <option value="armament-3">Вооружение (3)</option>
                        <option value="armament-4">Вооружение (4)</option>
                        <option value="armament-5">Вооружение (5)</option>
                    </select>
                </div>
            </div>
            <div class="mb-3 row">
                <div class="d-grid gap-2 d-md-block">
                    <button type="button" class="btn btn-outline-danger" onclick="addCardClick('red')">В красную</button>
                    <button type="button" class="btn btn-outline-success" onclick="addCardClick('green')">В зелёную</button>
                    <button type="button" class="btn btn-outline-primary" onclick="addCardClick('blue')">В синюю</button>
                </div>
            </div>
        </form>
        
        <button type="button" class="btn btn-secondary btn-sm" onclick="toggleBuildDeckClick()">Собрать колоды</button>
        <button type="button" class="btn btn-secondary btn-sm" onclick="init()">Сброс колод</button>
        <hr>
    </div>
    <div class="container" id="buildDeckContainer" hidden>
        <form id="multipleAdd">
            <div class="row">
                <div class="mb-3 col-6">
                    Медикаменты<input class="form-control" type="number" name="medicaments">
                </div>
                <div class="mb-3 col-6">
                    Хлам<input class="form-control" type="number" name="junk">
                </div>
            </div>
            <div class="row">
                <div class="mb-3 col-6">
                    Бинокль<input class="form-control" type="number" name="binoculars">
                </div>
                <div class="mb-3 col-6">
                    Топливо<input class="form-control" type="number" name="fuel">
                </div>
            </div>
            
            <div class="row">
                <div class="mb-3 col-6">
                    Пистолет<input class="form-control" type="number" name="pistol">
                </div>
                <div class="mb-3 col-6">
                    Фонарь<input class="form-control" type="number" name="flashlight">
                </div>
            </div>
            
        
            <div class="row">
                <div class="mb-3 col-6">Противоядие<input class="form-control" type="number" name="antidote"></div>
                <div class="mb-3 col-6">Засада<input class="form-control" type="number" name="ambush"></div>
            </div>
            <div class="row">
                <div class="mb-3 col-6">Запчасти<input class="form-control" type="number" name="spares"></div>
                <div class="mb-3 col-6">Рюкзак<input class="form-control" type="number" name="rucksack"></div>
            </div>
            <div class="row">
                <div class="mb-3 col-6">Рация<input class="form-control" type="number" name="radio-set"></div>    
            </div>
            <div class="row">
                <div class="mb-3 col-6"><label class="form-label" style="color: green">Продукты <span id="productsCount"></span></label><input class="form-control" type="number" name="products-random"></div>
                <div class="mb-3 col-6"><label class="form-label" style="color: blue">Вооружение <span id="armamentsCount"></span></label><input class="form-control" type="number" name="armament-random"></div>
            </div>
            <div class="mb-3 row">
                <div class="d-grid gap-2 d-md-block">
                    <button type="button" class="btn btn-outline-danger" onclick="batchAddCardClick('red')">В красную</button>
                    <button type="button" class="btn btn-outline-success" onclick="batchAddCardClick('green')">В зелёную</button>
                    <button type="button" class="btn btn-outline-primary" onclick="batchAddCardClick('blue')">В синюю</button>
                    <button type="button" class="btn btn-secondary" onclick="batchClear()">Сбросить</button>
                </div>
            </div>
        </form>

        <hr>

        
        <form>
            <p>Случайные продукты:</p>
            <div class="mb-3 row">
                <div class="d-grid gap-2 d-md-block">
                    <button type="button" class="btn btn-outline-danger" onclick="addRandomCardClick('red', products)">В красную</button>
                    <button type="button" class="btn btn-outline-success" onclick="addRandomCardClick('green', products)">В зелёную</button>
                    <button type="button" class="btn btn-outline-primary" onclick="addRandomCardClick('blue', products)">В синюю</button>
                </div>
            </div>
            <p>Случайное вооружение:</p>
            <div class="mb-3 row">
                <div class="d-grid gap-2 d-md-block">
                    <button type="button" class="btn btn-outline-danger" onclick="addRandomCardClick('red', armaments)">В красную</button>
                    <button type="button" class="btn btn-outline-success" onclick="addRandomCardClick('green', armaments)">В зелёную</button>
                    <button type="button" class="btn btn-outline-primary" onclick="addRandomCardClick('blue', armaments)">В синюю</button>
                </div>
            </div>
        </form>

        <hr>

        <form>
            <div class="mb-3 row">
                <div class="d-grid gap-2 d-md-block">
                    <button type="button" class="btn btn-outline-primary" onclick="shuffleDeckClick()">Перемешать всё</button>
                </div>
            </div>
        </form>

        <div class="mb-3 row">
            <div class="d-grid gap-2 d-md-block">
                <button type="button" class="btn btn-outline-danger btn-sm" onclick="viewDeckClick('red')">Список карт</button>
                <button type="button" class="btn btn-outline-success btn-sm" onclick="viewDeckClick('green')">Список карт</button>
                <button type="button" class="btn btn-outline-primary btn-sm" onclick="viewDeckClick('blue')">Список карт</button>
            </div>
        </div>
    </div>

    <script>
        const decks = {
            red: [],
            green: [],
            blue: [],
        };

        const countProducts = {
            'products-1': 4,
            'products-2': 4,
            'products-3': 3,
            'products-4': 2,
            'products-5': 1,
            'products-1-all': 1,
        };

        const countArmament = {
            'armament': 4,
            'armament-2': 2,
            'armament-3': 1,
            'armament-4': 2,
            'armament-5': 1,
        };

        const products = [];
        const armaments = [];

        function fillCards(counters, cards) {
            for (const name in counters) {
                if (Object.hasOwnProperty.call(counters, name)) {
                    const count = counters[name];
                    for (let index = 0; index < count; index++) {
                        cards.push(name);
                    }
                }
            }
        }

        function init() {
            decks.red = [];
            decks.green = [];
            decks.blue = [];

            products.splice(0, products.length);
            armaments.splice(0, products.length);

            fillCards(countProducts, products);
            fillCards(countArmament, armaments);
            batchClear();
            updateDeckSize();
        }

        function toggleBuildDeckClick() {
            const container = document.getElementById('buildDeckContainer');
            const hidden = container.hidden;
            container.hidden = !container.hidden;
        }

        function shuffle(array) {
            for (let i = array.length - 1; i > 0; i--) {
                let j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }

        function viewDeckClick(color) {
            alert("В колоде: " + shuffle([...decks[color]]));
        }

        function addRandomCardClick(color, cards) {
            if (cards.length === 0) {
                alert("Закончилось");
                return;
            }
            if (addRandomCard(color, cards)) {
                alertStatusAdd(document.getElementById('status-alert'), 'Добавлена карта: ' + cardOption.innerText, 'success');
            }
        }

        function addRandomCard(color, cards) {
            if (cards.length === 0) {
                return false;
            }
            const rndCardIdx = Math.floor(Math.random() * cards.length);
            const randomCardName = cards[rndCardIdx];
            decks[color].push(randomCardName);
            cards.splice(rndCardIdx, 1);

            const select = document.getElementById('add-card-select');
            const cardOption = select.querySelector(`option[value=${randomCardName}]`);

            updateDeckSize();
            return true;
        }

        function shuffleDeckClick() {
            decks.red.sort(() => Math.random() - 0.5);
            decks.blue.sort(() => Math.random() - 0.5);
            decks.green.sort(() => Math.random() - 0.5);

            alertStatusAdd(document.getElementById('status-alert'), 'Перемешано', 'success');
        }

        function alertStatusAdd(target, message, type) {
            const wrapper = document.createElement('div');
            wrapper.classList.add('alert', `alert-${type}`, 'alert-dismissible');
            wrapper.innerHTML = [
                `   <div>${message}</div>`,
                '   <button type="button" class="btn-close" data-bs-dismiss="alert"></button>',
            ].join('');
            target.append(wrapper);
            setTimeout(() => {
                wrapper.querySelector('.btn-close').click();
            }, 1500);
        }

        function getCardText(cardName) {
            const select = document.getElementById('add-card-select');
            const cardOption = select.querySelector(`option[value=${cardName}]`);
            return cardOption.innerText;
        }

        function addCardClick(color) {
            const cardSelect = document.getElementById("add-card-select");
            const selectedCard = cardSelect.options[cardSelect.selectedIndex].value;
            const directTo = document.querySelector("input[name='put-direct']:checked").value;
            if ('up') {
                decks[color].unshift(selectedCard);
            } else {
                decks[color].push(selectedCard);
            }
            const statusAlert = document.getElementById('status-alert');
            alertStatusAdd(document.getElementById('status-alert'), 'Добавлена карта: ' + cardSelect.options[cardSelect.selectedIndex].innerText, 'success');

            updateDeckSize();
        }

        function drawCardClick(color) {
            if (decks[color].length > 0) {
                let drawnCard = decks[color].shift();
                alert("Взяли карту: " + getCardText(drawnCard));
                updateDeckSize();
            } else {
                alert("Колода пуста!");
            }
        }

        function updateDeckSize() {
            const deckSizeHints = document.getElementsByClassName('deck-size');
            deckSizeHints[0].textContent = `(${decks.red.length})`;
            deckSizeHints[1].textContent = `(${decks.green.length})`;
            deckSizeHints[2].textContent = `(${decks.blue.length})`;

            document.getElementById('productsCount').textContent = `(${products.length})`;
            document.getElementById('armamentsCount').textContent = `(${products.length})`;
        }

        function batchAddCardClick(color) {
            decks[color] = [];
            const inputs = document.getElementById('multipleAdd').querySelectorAll('input');
            inputs.forEach((el) => {
                const count = el.value;
                const cardName = el.getAttribute('name');
                for (let idx = 0; idx < count; idx++) {
                    if (cardName === 'products-random') {
                        addRandomCard(color, products);
                    } else if(cardName === 'armament-random') {
                        addRandomCard(color, armaments);
                    } else {
                        decks[color].push(cardName);
                    }
                }
            });
            updateDeckSize();
            shuffleDeckClick();
        }

        function batchClear() {
            document.getElementById('multipleAdd').querySelectorAll('input').forEach((el) => {
                el.value = 0;
            })
        }

        // init
        init();
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha1/dist/js/bootstrap.bundle.min.js"
        integrity="sha384-w76AqPfDkMBDXo30jS1Sgez6pr3x5MlQ1ZAGC+nuZB+EYdgRZgiwxhTBTkF7CXvN"
        crossorigin="anonymous"></script>
</body>

</html>